Vokabeln die ich vergesse:
Controllable  Local  Systems (CLS)
Seite 146 technische Richtlinie unglaublich wichtig! bzw kapitel 4.3.1
Mehrfachzugriff (wenn mehrere Teilnehmer auf einen Zeitslot vom DC-net zugreifen)
schauen was der Messstellenbetreiber macht und wie das mit der authentifikation zusammenhängt (zwischen stromanbieter und SMGW)

Top-down methode: die SMGW bilden mit anderen SMGW ein DC-Netz (lokale Gruppen) und schicken verteilt mehrere Teilverbräuche an den Stromanbieter.
Problem: SMGW können nicht miteinander kommunizieren(mögliche Lösung wurde bereits aufgeschrieben und SMGW müssten technisch in der Lage dazu sein mehrere Meterverbräuche zu addieren bzw.
es könnte an dieser Stelle zu neuen implementationsfehler kommen(und zu sicherheitsschwächen führen)

Bottom-up methode: einzelne Meter bilden ein DC-Net und schicken ihre aggregierten Ergebnisse an das SMGW.
Problem: Meter müssen miteinander kommunizieren dürfen.(können aber laut richtlinie nur mit dem SMGW kommunizieren)
könnte mit Diffie-Helmann gelöst werden.
Problem:
Das SMGW MUSS auf  Anforderung  des  SMGW  Administrators Schlüssel  und  Zertifikate für  die  Kommunikation  mit  Zählern  im  LMN  erstellen,  verteilen,  aktivieren, deaktivieren bzw. löschen können.
SMGW könnte jede Kommunikation über Meter mitlesen, aber geht nicht mehr wenn Diffie-Hellmann.
ABER meter haben soweit ich weiß keine IP-Addressen? Wie könnten Sie untereinander kommunizieren?

Notizen für Design:
/////////////////////Top-down Approach
Es gibt eine .pdf vom BSI in der Informationen zum Sicherheitsmodul gefunden werden können. Also welche kryptografische Operationen werden unterstützt.

HEADER: |DC-Net Identifier|Client-Identifier|Übertragungsbit|Zeitstempel|Daten(lokale Summe) |
DC-Net Identifier: eineindeutiger Identifier, der angibt in welchem DC-Netz sich ein SGMW befindet
Client-Identifier: eineindeutiger CLient Identifier, jeder Client bekommt in einem DC-Netz einen eineindeutigen Identifier
Zeitstempel: Ist ein Zeitstempel, der angibt für welche generation die daten (lokale summe) bestimmt sind.
wo die Benachrichtigungsnachricht vom Stromprovider hin?
Wie sieht eine Benachrichtigung aus vom SGMW um in ein DC-Netz einzutreten?
Wie sieht eine Notfallnachricht von SMGW an den Stromprovider aus?
Wie sehen die Tunnelinformationen aus?

Kommunikation:
In diesem Protokoll wird davon ausgegangen, dass alle SMGW in einem 15 minütigen Takt Stromverbräuche an einen Stromanbieter senden. 

Operationen:
Hier werden alle Möglichen Operationen aufgelistet, die im Protokoll berücksichtigt werden:

-Systeminitialisierung: Wie wird ein mögliches DC-Nets initialisiert in einem bestehenden System? Wie wird eine Verbindung im DC-Netz aufgebaut? Wie findet eine Verbindung statt?

Lösung:
Jedes DC-Netz (im Falle von mehreren Netzen) erhält eine eineindeutige Identifikationsnummer. Smart Meter Gateways müssen als Clients mit anderen Smart Metern Gateways kommunizieren. Damit die Inhaltsdaten nicht mitgelesen werden können, muss ein Schlüsselgraph erstellt werden, der definiert wie Clients untereinander kommunizieren und ihre Schlüssel addieren oder subtrahieren. Tauschen zwei Clients einen Schlüssel miteinander aus, entsteht eine Kante im Schlüsselgraph. Andere Teilnehmer im DC-Netz wissen jedoch nicht, dass eine Kommunikationsverbindung erstelllt wurde. Gleichzeitig tauschen die beiden Clients Kommunikationsdetails miteinander aus wie z.B die eineindeutige TeilnehmerId, die jeder Teilnehmer im DC-Netz erhält. Die beiden Clients (und auch alle anderen Teilnehmer mit ausnahme des Stromproviders) können keinen Überblick über den eigentlichen Schlüsselgraphen haben, aber durch die ausgetauschten Kommunikationsdetails kennt jeder Teilnehmer im DC-Netz die Identifikationsnummer(oder Teilnehmernummer) seines Nachbarns.
Der Schlüsselaustausch zwischen zwei Clients spielt dabei eine zentrale Rolle. Für jede gesendete Nachricht muss ein neuer Schlüssel erstellt werden und dann mit der Nachricht verknüpft(Xored) werden.
Damit nicht bei jeder DC-Runde ein neuer Schlüsselaustausch durchgeführt werden muss, werden einmalig Seeds ausgetauscht mit denen jeweils ein PRNG pro Client initialisiert wird. Wenn unter gleichen Bedingungen der PRNG auf beiden Clients initialisiert wird, dann wird jeweils der gleiche Schlüssel erzeugt. Das führt zu einer Reduktion der theoretischen Sicherheit, aber mit guten PRNG kann immernoch
eine komplexitätstheoretische Sicherheit erreicht werden.


-Registrierung: Ein Smart Meter Gateway muss sich bei einem Stromanbieter registrieren und sich beim DC-Netz anmelden. (Wie sieht der Schlüsselgraph aus?) (Wie wird mit anderen Smart Meter Gateways kommuniziert, obwohl dies nicht technisch möglich ist)
-Nutzerwechsel: mehrere private Nutzer können den Stromanbieter wechseln. Wie wird damit umgegangen? stabiles system etc... (wird das vom smart meter gateway oder vom admin ausgelöst?)

Verbindungsaufbau zwischen zwei SGMWs:
Technische Hindernisse:
In der technischen Richtlinie vom BSI wird definiert, welche Anforderungen und mit welchen Rechten Smart Meter kommunizieren dürfen.
Mit der aktuellen Richtlinie ist es Smart Metern nicht erlaubt ins WAN zu kommunizieren außer es handelt sich um eine Kommunikation mit dem SMGW Admin oder Kommunikation an externe Marktteilnehmer. Es ist nicht vorgesehen, dass verschiedene SMGW untereinander kommunizieren.

Registrierung:
Eine mögliche Lösung wäre es, wenn ein Teilnehmer ,der sich im DC-Netz anmelden möchte eine spezielle definierte Anfrage an seinen Stromanbieter sendet. Diese Anfrage stellt eine Bitte des SMGW dar, sich in einem DC-Netz anzumelden. Der Stromanbieter ordnet dem anfragenden DC-Client in eine geographische Region zu und schlägt einen geeigneten und bestenfalls bereits im DC-Netz angemeldeten Clients(SMGW) vor. Der Stromprovider baut nun einen Tunnel auf und sendet die Tunnelinformationen an den DC-Client und den registrierenden Client. Über diesen Tunnel ist es den beiden SGMW möglich eine Kommunikationsverbindung über den Stromanbieter aufzubauen. Der DC_Client wird nur vom Stromprovider informiert, dass dieser einen neuen Nachbarn erhält und Kontaktinformationen austauschen muss.
Das anfragende SMGW muss nun noch die Seeds zu einem (oder mehreren) Clients im DC-Netz senden. 
Damit der Stromprovider die Seeds nicht mitlesen kann, tätigen die CLients über den bereit gestellten Tunneln einen Diffie Helmann Schlüsselaustausch, um verschlüsselte Nachrichten versenden zu können. Sobald einmal die Seeds ausgetauscht wurden, wird der Stromprovider von dem anfragenden Client informiert, dass dieser erfolgreich im DC-Netz eingetreten ist.(vllt durch eine verifikation?) Anschließend können alle Teilnehmer im DC-Netz ihre lokale Summen an den Strom provider senden und dieser bildet die globale Summe. Der Stromprovider ist dafür zuständig, dass Nachrichten bei Bedarf auch in Zukunft über den bereits genutzen Tunnel zwischen den angemeldeten Clients ausgetauscht werden können.

Die bereits angemeldeten Clients können sich also nicht aussuchen, welche neuen Kommunikationspartner sie bekommen. Zusätzlich muss darauf geachtet werden, dass es eine Mindestanzahl an Teilnehmern pro DC-Netz nicht unterschritten wird. Eine bestimmte Gruppe kann den verbrauch einer Stadt wiederspiegeln und so kann der Stromverbrauch lokal/geographisch nachzuvollzogen werden). 

(der Gedanke ist, dass es viele verschiedene kleine DC-Netze gibt, die getrennte Schlüsselgraphen besitzen, jedes DC-Netz sendet seine lokale Summe an den Stromanbieter, der alle Werte aufsummiert und die globale Summe bildet (für ein DC-Netz)

Bei diesem Ansatz muss keine Authentifizierung zwischen dem anfragenden SMGW und dem Stromprovider durchgeführt werden. Denn der Stromprovider ist bereits (von dem SMGW Gateway) verifiziert worden. 

Austritt aus dem DC-Netz:

Also mittels eines sicheren kanals, der durch den Diffie-Hellman schlüsselaustausch erzeugt wurde, können die Seeds für einen PRNG kommuniziert werden.
-Was passiert wenn ein Teilnehmer entfernt wird? 
Dann wird eine definierte Nachricht an den Stromprovider gesendet. Damit teilt das SMGW dem Stromprovider mit, dass es aus dem DC-Netz austreten wird. Nun informiert der Stromprovider die Nachbarn des austretenden Clients mit einer Benachrichtigungsnachricht 001. Mit dieser Benachrichtigung wird den Nachbarn signalisiert, dass sie ihre PRNG konfigurationen zu Client X wegwerfen und diese somit nicht weiter in der Berechnung der lokalen Summe (in der nächsten generation) verwendet werden darf. Damit es nicht zu einer Störung der Synchronisation im DC-Netz kommt(was dazu führt, dass keine sinnvolle globale Summe errechnet werden kann), müssen die "Nachbarn" eine Bestätigung(das die Nachricht verstanden wurde und alle Seeds weggeworfen wurden) an den Stromprovider senden. (was wenn nicht bestätigt wurde?)
Schlüsselgraphen:
Es kann dazu kommen, dass beim Austritt eines Clients der DC-Schlüsselgraph in zwei Teile zerbricht. Das Problem hierbei ist, dass weder die SMGW Clients noch der Stromanbieter wissen, ob sich der Schlüsselgraph zerteilt. Sollte dies der Fall sein, so senden zwei voneinander getrennte DC-Netze auf die gleiche DC-Netz ID. Der Stromprovider könnte zwar trotzdem eine sinnvolle globale Summe bilden(weil quasi zwei globale Summen aufaddiert werden), aber man könnte schnell den überblick aus den daraus resultierenden Schlüsselgraphen verlieren und die Mindestanzahl der Teilnehmer in einem DC-Netz könnte unterschritten werden. Eine mögliche Fehlererkennung bei Problemen könnte gar unmöglich werden.
Um eine Funktionsfähigkeit/Wartbarkeit des Schlüsselgraphen zu gewährleisten werden folgende Maßnahmen getroffen:
Der Stromanbieter besitzt alle Informationen zu den Schlüsselgraphen, da der Stromprovider beim Registrierungsprozess einen Kommunikationsaufbau zwischen zwei Clients herstellt. Deshalb weiß der Stromprovider von jeder Verbindung, die im Schlüsselgraph hergestellt wurde und speichert diese ab. Tritt ein Client aus dem DC-Netz aus, so wird ein Registrierungsprozess zwischen den Nachbarn des austretenden Clients veranlasst. Damit wird bei jedem austritt sichergestellt, dass der Schlüsselgraph intakt bleibt. 

Sollte ein DC-"Nachbar" durch den Austretenden CLient komplett von einem DC-Netz getrennt werden, so muss dieser abgetrennte Client eine besondere NotfallNachricht an den Stromprovider senden und dann wird ein neuer Anmeldevorgang initiiert. 

Anmerkung: der stromprovider kennt den Schlüsselgraphen. Denn er verbindet alle SMGWs miteinander. Wenn also ein SMGW eine anfrage stellt, dass er in ein dc-netz eintreten möchte, dann bildet der Stromprovider einen tunnel um eine kommunikation zwischen zwei SMGW herzustellen. Der Stromprovider kann in diesem Fall davon ausgehen, dass diese beiden SMGW eine Kante in dem Schlüsselgraphen bilden und könnte dementsprechend(wenn er dies von anfang an tut) den Schlüsselgraphen nachbilden. Da in dem Angreifermodell davon ausgegangen wird, dass der Stromprovider honest-but-curious ist, wird dem Stromprovider unterstellt, dass dieser den Schlüsselgraphen trackt. Jedoch kann dieser keine zusätzlichen Informationen davon ableiten(es sei denn der Stromprovider schmuggelt Fake SMGW in das DC-Netz ein)

Annahme: Pro generation darf nur ein SMGW aus dem DC-Netz austreten! 

Siehe notizen auf dem blog!

Internetausfall/Ausfall von dem SMGW:

Was tun bei einem Internetausfall -> zu jeder lokalen Summe wird ein Zeitstempel angefügt. Dann können die Nachrichten auch später an den Stromprovider gesendet werden.
Dieser kann dann auch nach einen späteren Zeittick(Generation) die Daten wieder zusammensetzen. 
Was wenn ein SMGW über längere Zeit ausfällt?
1.Sobald ein SMGW in einer Generation keine lokale Summe sendet, dann wird es als faulty angesehen. Der Stromprovider kann es sich nicht leisten auch nur für eine halbe Stunde keine Messwerte auswerten zu können. Deshalb sendet der Stromprovider eine Benachrichtigung 002 an die Nachbarn des ausgefallenden SMGW. Diese speichern den Schlüssel des nicht erreichbaren Nachbarn in einem backup ab, aber werden in der nächsten Generation den Schlüssel nicht verwenden um die lokale Summe zu bilden. Somit wäre das DC-Netz bereits nach 30 minuten wieder funktionsfähig.
Sollte der defekte Nachbar wieder kommunikationsfähig sein, dann sind zwei möglichkeiten denkbar:
1.1. das SMGW muss seinen Stromverbrauch nicht nachsenden und wird wieder einem DC-Netz hinzugefügt.
1.2. die backupSchlüssel von den Nachbarn werden benutzt. Doch diesmal wird für die lokale Summe die schlüssel von den nicht defekten Nachbarn abgespalten und nur der SChlüssel von dem defekten Nachbarn benutzt. Daraufhin wird per Zeitstempel die verlorenen Generationen nachgesendet. (die nicht defekten nachbarn würden dann allerdings doppelt gerechnet)
1.3. wie zweitens bloß, dass es einem Zeitraum gibt z.b 0:00 wo alle nicht gesendeten stromverläufe nachgesendet werden)

2. Sobald ein SMGW in einer Generation keine lokale Summe sendet, dann wird es als faulty angesehen. Der Stromprovider erkennt das faulty SMGW, durch die CLient-Id die bisher nicht übermittelt wurde und durch das unvollstädige Übertragungsbit(also wie viele Sender gesendet haben). Durch das unvollständige Übertragungsbit weiß man wie viele "defekte" SMGW Clients es gibt. Der Stromprovider kann nicht die globale Summe bilden und hat somit keinen Überblick über das Stromnetz. Daher broadcastet der Stromprovider Benachrichtigung 002 und alle Clients werfen ihre Schlüssel von den defekten Clients weg und bilden erneut in der gleichen Generation eine lokale Summe nur ohne SChlüssel des defekten CLients. 
Sollte ein Client durch zufall nun keinen Schlüssel mehr haben mit dem die lokale Summe überlagert werden kann, weil sein einziger Nachbar faulty ist ,so sendet dieser eine Notnachricht an den Stromprovider. Dieser führt einen erneuten Registrierungsschritt mit dem abgetrennten Client aus und verbindet diesen mit dem DC-Netz bevor die lokalen Summen gebildet werden.

Der faulty client kann durch den Internetausfall nicht rechtzeitig die lokale summe versenden. Das bedeutet der faulty client kann mehrere generationen verpassen und muss deshalb stromverbräuche nachsenden. Dies kann der faulty client in einem extra zeitfenster nachsenden, indem nur der nachbar eines faulty clients und der faulty client nachsenden. (der nachbar sendet 000 und der faulty client seine verspätete lokale summe). Das funktioniert aber nur, wenn mindestens zwei faulty clients für ein zeitfenster nachsenden. ansonsten könnte der stromanbieter einfach folgendes berechnen: neues ergebnis - altes ergebnis = stromverbrauch von dem faulty client.

also es ist wahrscheinlich besser einfach so den stromverbrauch nachzusenden ohne dc-netz.

Durchführung: Bisher wurden technische Schritte erklärt um ein DC-Netz in das bereits operierende Stromnetz zu implementieren. Wie sieht eine typische Operation im Stromnetz aus?
Am besten wäre es, wenn es eine synchronisierte Uhrzeit gibt in der alle DC-Netze(in einer Region) gleichzeitig senden und überlagern. Aus den DC-Netzen werden mehrere Teil-Stromverbräuche gesendet, die an den Stromanbieter weitergeleitet werden. Der Stromanbieter muss nur alle Teilverbräuche (lokale Summen) addieren und bekommt somit den Gesamtverbrauch des Stromnetzes. Diese Daten sind komplett anonym und gibt nur die Auskunft über den Gesamtverbrauches eines kleinen DC-Netzes aus. In der Technischen Richtlinie wird auch erwähnt, wie die Zähler Zeit synchronisieren, also ist eine Zeitgleiche sendung von Nachrichten durchaus umsetzbar.

Was passiert, wenn alle eine globale Summe senden, aber diese inkorrekt ist?

Implementation des DC-Netzes im SMGW:

Abbildung 26 technische Richtlinie:
Die Abbildung zeigt ein Diagramm wie die Messwerte intern im SMGW verarbeitet werden. Da das SMGW eine zentrale Rolle in der Lösung spielt, ist dieses Diagramm wichtig um die technischen Details zu illustrieren. Zunächst muss erwähnt werden, dass gewisse terminologische Anforderungen durch die technische Richtlinie gestellt werden. "Das  SMGW MUSS mindestens  folgende  Informationen  an  der  Schnittstelle  für  Anzeigeeinheiten bereitstellen....
Dabei müssen Verbrauchs-sowie Einspeisewerte für die folgenden Zeiträume bereitgestellt werden:die letzten 7 Tage, Tag für Tag ,die letzte Woche (aggregiert)."
Deshalb sollten die lokale Summe erst nach der Messwertverarbeitung bzw. dem Schritt "Messwerte neuer Messgrößen" gebildet werden. Dabei ist zu beachten, dass es möglicherweise zu einer Einschränkung der Konfiguration der Auswertungsprofile bzw. Kommunikationsprofile führen kann. Das sollte jedoch zu keinen größeren Problemen führen(da durch das DC-netz sicherlich einige Regeln "nicht mehr möglich" sind, aber trotzdem ein Großteil aller Funktionen durchführbar sind). Mit diesem Ansatz kann ein DC-Netz implementiert werden, ohne großartig die interne Struktur des SMGW zu ändern.

Vllt noch schreiben, ob dadurch Ereignisse wie eichtechnische Logeinträge erschwert werden, durch die Anonymität?
Antwort nein, da die Operationen des DC-Netz innerhalb der Funktionalität des SMGW erst so spät durchgeführt werden. Deshalb wurden die wichtigen Operationen wie Messwertverarbeitung und logbuch einträge bereits ausgeführt.

Fehlertoleranz:
vllt sowas wie der Kollisionsauflösungsalgorithmus mit Mittelwertbildung(also das es ein Bit für die Anzahl der Nachrichten gibt) um zu sehen wie viele Stationen senden konnten.(damit kann man sehen, ob es zu einem großflächigen stromausfall gekommen ist etc.)
---> Der Gedanke ist, dass ein DC-Netz,dass sich im Fehler modi befindet nur Leernachrichten sendet und das Nachrichtenbit nicht erhöht. So kann der Stromprovider abschätzen, wie viele DC-netze ausgefallen sind(Gesamtanzahl DC-Netze minus Anzahl Gesendeter DC_netze)

Die Fehlertoleranz im DC-Netz bezieht sich größtenteils auf die Erkenntnisse von Prof. Pfitzmann.
Damit ein DC-Netz arbeiten kann, müssen mehrere Anforderungen erreicht werden:
Bei dem DC-Netz müssen alle Schlüssel fehlerfrei ausgetauscht worden sein.( Es wurde bereits beschrieben wie der Schlüsselaustausch stattfindet) Die PNRG müssen synchron sein, damit die erzeugten Schlüssel gleich sind. Ein Fehler/fehlsynchronisation führt dazu, dass keine Teilnehmerstation senden kann. Erst wenn der fehler korrigiert wurde, ist ein Senden wieder möglich. (es sei denn es gibt redundanzen). Ziel dieser Arbeit ist, dass man möglichst kleine DC-Netze bildet, die trotzdem ein größtmögliches level an anonymität garantieren(nochmal nachfragen ob das stimmt.) 

Warum kleine DC-Netze?
DC-Netze sind besonders praktisch, wenn es um die Überlagerung von Nachrichten bzw. den Stromverbräuchen geht. Aber bereits bei einen Fehler von einem Verbraucher(wie z.B internetausfall) ist es niemanden im Netz mehr möglich sinnvoll zu Überlagern. Um eine möglichst hohe Verfügbarkeit zu erreichen, bietet es sich an mehrere minimal von einander getrennte DC-netze zu betreiben. Wenn es in einem kleinen DC-Netz zu einem Ausfall kommt kann ein Protokoll gestartet werden um den Fehler zu entdecken. Durch die Minimalität des DC-Netzes kann ein Ausfall von einem oder mehreren Netzen vernachlässigt werden. (da z-B. in großen städten es nicht auffällt, wenn eine Prozentual geringe menge nicht senden kann). Gleichzeitig können die Menge aller Sender aufaddiert werden (wie bei der mittelwertbildung). Damit weiß der Stromprovider wie viele sender es gibt und kann einschätzen wie Vertrauenswürdig die gelieferten Daten sind.

Warum kein senderpartitioniertes DC-Netz?
Aufwand soll nicht groß sein, aber die Senderanonymität wird verringert und es ist deshalb in dieser Arbeit nicht sinnvoll, da man durch die minimalen Netze nicht noch zusätzlich an anonymität einbüßen möchte. ABER es wird eine "vollständige Fehlerüberdeckung erreicht".

Pfitzmann Protokoll:
Transiente(also vorrübergehend) und permanente Fehler:
Die transienten Fehler im DC-Netz werden durch Ende-zu-Ende-Protokolle toleriert.
Permanente Fehler entstehen durch Desynchronisation (z.B durch PRNG)
Laut pfitzmann können fehler leicht behoben werden. Die Hauptarbeit liegt also in der Fehlererkennung und Fehlerlokalisierung.

Mögliche permanente Fehler:
Ausfall von PRNG -> neuverteilung der schlüssel bzw. seeds
Ausfall von modulo addierer -> austausch von addierern

Hauptproblem Fehlererkennung:

DC-Netze werden auf der Schicht 1 und Schicht 2 implementiert.

Fehler in der oberen Schicht 1 lassen sich durch Redundanzen wie CRC lösen, die am Ende einer Nachricht angefügt werden können.
Sollte es bei z.B. CRC zu einem ungültigen Prüfzeichen kommen, so liegt ein Fehler bei der Überlagerung vor.

Fehler bei Mehrfachzugriffsverfahren:
Man arbeitet mit zwei "Modi" eine normalen A-Modi und einen Fehlermodi F-modi in dem nach Fehlern gesucht wird.
Bei Fehler wird das Mehrfachzugriffsverfahren neuinitialisiert um mögliche transiente Fehler und Fehler in der oberen Schicht 1 auszuschließen.
Sollten trotzdem noch Fehler vorherrschen (oder es wurde ein anderer permanenter Fehler gefunden) wird in den F-modi umgeschaltet. Nun wird folgendes Protokoll umgesetzt.
Protokoll:
1. Jede Station erstellt einen recovery point und speichert die aktuell ausgetauschten schlüssel.
2. Nun wird eine selbstdiagnose ausgeführt. Es werden paarweise zufällige Schlüssel in den PRNG geladen und mit einer zufälligen Nachricht lokal überlagert. Sollte das Ergebnis nicht die zufällige Nachricht sein, so ist die Station fehlerhaft. Dies wird den anderen Stationen mitgeteilt. Die Schlüssel der fehlerhafte Station werden nun verworfen und es wird in den A-modus gewechselt.
ODER: Die station ist fehlerfrei so wird der recovery point wiederhergestellt.
Von hier aus gibt es 3 Fehlertypen, die auftreten könnten:
1. Eine Station, die so fehlerhaft ist, dass sie wieder ihren Fehler dem Netz mitteilen kann, noch kommunizieren kann.
2. Schlüssel/Synchronisationen von mind. 2 Stationen gingen verloren.
3. Das unterliegende Kommunikationsnetz, Globale überlagerung ist Fehlerhaft.

Um den Fehler genauer zu lokalisieren, werden die Schlüsselpaare Schritt für schritt halbiert(man startet bei der hälfte) und es werden leerbotschaften gesendet. 
Ist das ergebnis jedes mal 0 liegt der Fehler mit sehr hoher wahrscheinlichkeit in der anderen hälfte. Ein stuck at zero fault muss auch ausgeschlossen werden.

ODER das ergebnis ist nicht jedes mal 0. Dann befindet sich der Fehler in dieser hälfte und es wird weiter halbiert um den Fehler genauer zu lokalisieren.

Wenn der Schlüsselgraph nur noch eine Kante besitzt und weiterhin nach 100 Tests nicht nur Nullen gesendet werden, dann Tauschen die beiden Letzten Stationen neue Schlüssel aus bzw. einen neuen PRNG-Startwert. Damit kann man Schlüsselsynchronisationsfehler erkennen.

Sollte wiederum immer noch keine korrekten Nachrichten übermittelt werden zwischen den zwei Stationen, dann werden die eben ausgetauschten schlüssel verworfen und es werden neue Schlüssel bzw. PRNG-Startwert mit einer dritten und vierten Station ausgetauscht. Dann wird der Test wiederholt. Sollte der Test weiterhin fehlerhaft ausfallen, so ist mit hoher Wahrscheinlichkeit das zugrundeliegende Kommunikationsnetz oder die globale Überlagerung fehlerhaft.

ODER beim zugrundeliegenden Test ist nur ein Test fehlerhaft. Dann ist die ursprüngliche verdächtige Station als fehlerhaft angesehen und aus dem betriebgenommen(aus dem Schlüsselgraphen entfernt).
Dann kann wieder in den A-Modus geschaltet werden und das Mehrfachzugriffsverfahren wird neu initialisiert.

Eigenschaften:

1. Anonymität:
Durch die Nutzung von PRNG sinkt die Anonymität von informationstheoretisch sicheren zu einer komplexitätstheoretisch sicheren Anonymität. Trotzdem
Auch wenn ein SMGW von einem Angreifer kontrolliert werden sollte, dann wäre es nicht dem Angreifer möglich den Stromverbrauch von anderen SMGW mitzulesen. Denn der Angreifer hat keinen Zugriff auf die globale Summe. Diese kann erst bei Stromprovider errechnet werden. Mit dem vorgeschlagenen Verfahren fehlen dem Angreifer die nötigen Informationen um einen potentiellen Angriff auf das DC-Netz zu starten(wenn dieser nur die Kontrolle über ein SMGW hat). Des Weiteren hat der Angreifer auch keine Informationen über den Schlüsselgraphen. Das erschwert die Chancen auf einen erfolgreichen Angriff zusätzlich. Zumal (weiter oben bzw. siehe Blog) ein Verfahren vorgeschlagen wurde, indem das DC-Netz operieren kann ohne das auch nur ein Teilnehmer Kenntnisse vom gesamten Schlüsselgraphen hat. Zwar wäre der Stromprovider technisch in der Lage den Schlüsselgraphen zu speichern, aber erst wenn ein AngreiferSMGW und der Stromprovider zusammenarbeiten, wären Angriffe auf die Anonymität möglich.

(halbwegs debunked)
Nur in spezialfällen wäre es möglich, dass ein kontrolliertes SMGW ein weiteres SMGW abhören kann(bzw. mehrere und zwar genau dann, wenn der Angreifer der Parent von Leafs ist), aber dann hätte der Angreifer nur die aggregierten Messwerte aller Meter, die das abgehörte SMGW betreut. Des Weiteren ist es durch die Technische Richtlinie nicht möglich, dass SMGW Admins einzelne Meterdaten anfordern/lesen können. Dadurch müssen potentiell kontrollierte SMGW nicht betrachtet werden. Außerdem gilt es in dieser Arbeit herauszufinden, wie minimal DC-Netze sein können, um eine größtmögliche Anonymität mit der höchstmöglichen Verfügbarkeit zu erreichen.

2. Authentifizierung: 
Ein Smart meter muss nicht authentifiziert werden durch das DC-Netz. Die Operationen, die im DC-Netz stattfinden, werden erst spät bei der Messwertverarbeitung ausgeführt. Bis zu diesem Zeitpunkt wurden die Messwerte und die Meter bereits authentifiziert. Sollten bei der Authentifizierung probleme auftreten, so könnten diese wie bei SMGW ohne DC-Netz ins eichtechnische Logbuch bzw. ins Systemlogbuch eingetragen werden. Ansosten ist der Eintritt in das DC-Netz ein kritischer Punkt. Das SMGW muss auch nicht authentifiziert werden(warum eigentlich genau?) Hat das sicherheitsmodul, damit kann sich das smart meter gateway ausweisen. Deshalb kann der fall vernachlässigt werden.

Man möchte vermeiden, dass potentielle Angreifer(mit fake SMGW) in das Netz eintreten um Daten klauen zu können. Deshalb muss zwischen dem Strom provider und dem SMGW eine klare Authentifizierung stattfinden, die nur bei Erfolg ein SMGW in das DC-Netz aufnimmt.

3. Verfügbarkeit:
Es ist mit einer sehr hohen Verfügbarkeit mit DC-Netzen zu rechnen. Trotzdem müssen einige Vorkehrungen getroffen werden, um eine hohe Verfügbarkeit zu gewährleisten. Es wurde bereits erwähnt, dass es zu transienten als auch permanenten Fehlern kommen kann. Treten diese Fehler auf, so ist es keinem Benutzer im DC-Netz möglich Nachrichten sinnvoll zu überlagern. Die Lösung hierfür ist, dass man mit mehreren voneinander getrennten DC-Netzen arbeitet. Sollte es zu einem Fehler in einem DC-Netz kommen, kann das DC-Netz vernachlässigt werden, da Fehler in kleinen DC-Netzen nicht so stark ins Gewicht fallen, als Fehler in wenigen großen DC-Netzen. Des Weiteren sollte ein Fehler bemerkt werden, so wurde ein Fehlerprotokoll beschrieben(Von Prof. Pfitzmann) welches die schwerwiegensten Fehler tolerieren kann und das System wieder in einen geordneten Zustand bringen kann. Sollte auch diese Möglichkeit versagen, so müsste ein techniker das Problem beheben. Nichtsdestotrotz könnte ein genaues Bild des Stromnetzes(welches Wort) auch wenn mehrere DC-Netze aktuell nicht senden können. Des Weiteren wurde auch beschrieben, welche Maßnahmen durchgeführt werden, wenn ein SMGW aus einem DC-Netz austritt und es zu einer Teilung des Schlüsselgraphes führt. Diese Maßnahmen mindern ebenfalls nicht die Verfügbarkeit und sollten keine Auswirkungen auf das laufende System haben.

4. Skalierbarkeit und Effizienz:
Die hier vorgeschlagene Struktur ist stark skalierbar, da neue Nutzer entweder zu bereits bestehenden DC-Netzen hinzugefügt werden oder selbst ein neues DC-Netz erstellen können. Da die größe von den DC-Netzen klein ist und alle Nutzer gleichzeitig überlagern (also zum gleichen Zeitpunkt senden) kommt es nicht zu einer Überlastung bzw. Bottleneck. 
Außerdem ist davon auszugehen, dass die Bildung der globalen Summe (also eine Runde im DC-Netz) effizient durchführbar ist. Denn abgesehen von der Schlüsselbildung werden im DC-Netz hauptsächlich Additionen mit Modulo durchgeführt, die leicht umsetzbar sind. Des Weiteren sollte es zu Fehlern kommen, können die im Protokoll vorgeschlagenen Fehlerkorrekturmaßnahmen schnell umgesetzt werden. Nur wenn es zu einem unwahrscheinlichen durch das Protokoll unlösbaren Fehler kommt, müssen Servicetechniker vor Ort den Fehler beheben. Der Strom provider bekommt von mehreren Hundert SMGW die aggregierten Stromverbräuche, die müssen dann nochmals addiert werden, aber das sollte ebenfalls zu keinen Performanceverlusten führen.


Siehe seite 253-255 im Skript

Wie umgehen mit Bit overflows also wenn addiert wird von 9+2 auf 11?


Zeitstempel für jede Nachricht mitsenden, falls internetausfall vorhanden ist.

Zeitsynchronisation:
siehe 3.2.6
//////////////////////////////// Bottom-Up Approach
-Systeminitialisierung: Wie wird ein mögliches DC-Nets initialisiert in einem bestehenden System?
Lösung: bei dem Bottom-up Approach kommunizieren mehrere Meter über ein DC-Netz im LMN.  
Warum ist es nicht möglich?
Terminologie:
MUSS bedeutet, dass es sich um eine normative Anforderung handelt.
DARF NICHT / DARF KEIN bezeichnet den normativen Ausschluss einer Eigenschaft.
SOLL  NICHT  / SOLL  KEIN kennzeichnet  die  dringende  Empfehlung,  eine  Eigenschaft auszuschließen. Abweichungen zu diesen Festlegungen müssen begründet werden. 
KANN / DARF bedeutet, dass die Eigenschaften fakultativ oder optional sind.

"Das SMGW MUSS zu jedem angeschlossenen Zähler aktuelle Zählerstände der relevanten gemessenen Messgrößen vorhalten. Der SMGW-Admin MUSS dazu konfigurieren können, welche Messgrößen  des  Zählers  relevant  sind  und  in  Form  von  aktuellen  Zählerständen  im  SMGW  abgebildet werden müssen"

Siehe Seite 146 technische Richtlinie. 
Laut dem aktuellen Konzept der Datenverarbeitung wäre es gar nicht möglich dem Endnutzer die Verbrauchsdaten mitzuteilen. Mit dem Bottom-up Approach ist es dem SMGW gar nicht möglich zu erkennen, von welchem Meter Verbrauchsdaten gesendet werden, da das DC-Netz Senderanonymität garantiert. Dementsprechend würden fast alle Anwendungsfälle im HAN nicht umsetzbar sein und eine Reihe von MUSS Anforderungen können nicht mehr garantiert werden. Da die Meter selbst mit(wahrscheinlich) nur mit geringen Anforderungen gebaut wurden und demtnentsprechend die Hardware nur wenig leisten kann, ist es nicht unrealistisch, dass Komponenten/Funktionen wie die Messwertlisten (für den Endnutzer) oder der Letztverbraucher Log im Meter zwischengespeichert werden. 

///////////////////////////////////////////
Punkte die Anna Biselli betrachtet hat.
///////////////////////////////////////////
Technische Hindernisse:
In der technischen Richtlinie vom BSI wird definiert, welche Anforderungen und mit welchen Rechten Smart Meter kommunizieren dürfen.
Mit der aktuellen Richtlinie ist es Smart Metern nicht erlaubt ins WAN zu kommunizieren außer es handelt sich um eine Kommunikation mit dem SMGW Admin oder Kommunikation an externe Marktteilnehmer. Es ist nicht vorgesehen, dass verschiedene SMGW untereinander kommunizieren.
Dabei führt das BSI auf, dass es die mindestanforderungen sind und dies gibt spielraum für erweiterungen der anwendungsfälle. Da es bereits erlaubt ist mit externen Markteilnehmern zu kommunizieren, kann man diesen Anwendungsfall erweitern indem die Kommunikation mit dem externen Markteilnehmer als Anmeldung für das DC-Netz genutzt wird. (das ist nur möglich, wenn das Anfragende SMGW noch nicht in einem DC-Netz ist)
---> Premisse, man vertraut dem SMGW admin (wie auch bei der arbeit von biselli)
1. Eine mögliche Lösung wäre es, dass ein neuer Teilnehmer, der sich im DC-Netz anmelden möchte eine spezielle Anfrage an seinen Stromanbieter sendet. Diese Anfrage stellt eine Bitte des SMGW dar, sich im 
DC-Netzes anzumelden. Nun werden verschiedene zufällige und bereits angemeldete Clients(SMGW) vom Stromprovider vorgeschlagen(bzw. ein zufälliger client aus einer bereits bestehenden DC-Netz gruppe). Die bereits angemeldeten Clients können sich also nicht aussuchen, welche neue Kommunikationspartner sie bekommen (der Gedanke ist, dass es viele verschiedene kleine DC-Netze gibt, die getrennte Schlüsselgraphen besitzen, jedes DC-Netz sendet seine globale Summe an den Stromanbieter, der alle Werte aufsummiert. Man muss nur darauf achten, dass es eine Mindestanzahl an Teilnehmern pro DC-Netz gibt. Des Weiteren können dadurch auch geographische Gruppen gebildet werden. Also eine bestimmte Gruppe spiegelt den verbrauch einer Stadt wieder und so ist es möglich den Stromverbrauch lokal/geographisch nachzuvollziehen). Diese müssen als authorized external market participants bei den Anfragenden SMGW eingetragen werden, um eine Kommunikation zu erlauben(Diese Eintragung muss der SMGW Admin durchführen. auch hier wäre es sinnvoll, wenn ein bestimmter Befehl zwischen den SMGW definiert wird, um Kenntlich zu machen, dass der SMGW ins DC-Netz eintreten möchte. Einen bestimmter DC-Netz Header würde sich anbieten. Auch authentifikation ist wichtig, weil sonst potentiell malicious smgw in die netze eintreten können. In der hoffnung daten zu klauen. Deshalb sollte ein SMGW admin nur vom Stromprovider des DC-Netzes die Erlaubnis bekommen, das DC-Netz zu erweitern ). Gleichzeitig muss auch der SMGW admin vom zufällig ausgewählten Client den neuen Teilnehmer des DC-Netzes als authorized external market participant eintragen, um eine Kommunikation zu erreichen. Nun kann der neue Teilnehmer mit einem Client, der sich bereits im DC-Netz befindet, kommunizieren. Mittels eine Diffie-Hellman schlüsselaustausch (oder einen anderen Schlüsselaustausch der wahl) können nun die die SChritte der Systeminitialisierung durchgeführt werden. Ein weiterer Vorteil ist, dass bei einer Möglichen Fehlerkorrektur(wie bei Prof. Pfitzmann beschrieben) kleinere DC-Netze durchaus ausfallen könnten, da mehrere DC-Netze auch eine Redundanz darstellen und kleinere Netze vernachlässigbar sind, falls keine korrekten Daten geschickt werden können. Also besteht durchaus ein Interesse, dass man mehrere minimale (minimal im Sinne von kleinst mögliche Gruppe mit höchstmöglicher Anonymität) DC-Netze bildet.


Bei vielen kleinen DC-Netzen (und auch kleinen DC-Gruppen) kann dies zu einer Teilung von einem DC-Netz in zwei führen. Dann senden, die geteilten Netze einzeln ihre lokalen Summe an den Stromanbieter, der diese Summen addiert.(hier muss wieder darauf geachtet werden, dass nicht die minimale Anzahl an Teilnehmern eines DC-Netzes unterschritten wird.

(debunked) weil meistens ein SMGW einen Nutzer darstellt
Problem: Ein Smart Meter Gateway kümmert sich um die Meter Daten, aber wie verhält sich das Smart Meter Gateway, wenn unterschiedliche Meter bei unterschiedlichen Anbietern sind? und ein Anbieter z.B nicht im DC-Netz operiert. etc. 
-Mögliche Lösung: Zeitslots/Zeitraum. Jeder Anbieter bekommt einen Zeitslot/Zeitraum bei dem gesendet wird. Anbieter mit DC-Netzen können Zeitslots sperren, sodass es nicht zu einer "falschen(bad)" Überlagerung kommt.


(debunked)Log-Problem:
Laut den technischen Richtlinien müsste die interne Struktur des Logs abgeändert werden. Aktuell gibt es 3 verschiedene Log-Typen Letztverbraucher-Schnittstelle, CLS-Schnittstelle und die Service-Techniker-Schnittstelle. Die Letztverbraucher-Schnittstelle ist hier von interesse. Denn aktuell dürfen nur Letztverbraucher(also Consumer) auf diese Log-Daten mittels eines CLS-Gerätes aus dem HAN darauf zugreifen. Der aktuellste Letztverbraucher-Wert ist von Interesse für das DC-Netz. Deshalb braucht das SMGW zugriff auf diesen Wert um alle Letztverbraucher-werte (von einem Stromprovider) zu aggregieren. 
Damit dann die lokale Summe aus dem aggregierten Wert gebildet werden kann.

(debunked)
AggregierungsProblem:
1. "Aus  bestimmten  Messwerten  ermittelt  das  SMGW  mit  Hilfe  eines  Regelwerks  abgeleitete Messwerte und versendet diese verarbeiteten Werte an berechtigte externe Marktteilnehmer." Diese Messwerte werden in Messwertlisten im SMGW gespeichert. Das SMGW greift auf diese Liste zu und aggregiert alle Werte(von Metern die zum gleichen Stromprovider gehören), sodass die lokale Summe im DC-Netz gebildet werden kann. 
2. Da mehrere SMGW ein DC-Netz bilden, müssen sie sich abstimmen, dass nur ein SMGW die globale Summe an den Stromanbieter sendet. Ansonsten würde es zu Redundanz führen und zu einem falschen Ergebnis beim Stromanbieter.

schau mal nach den Failure handling fällen nach! für sachen die man beachten muss. Sollte im Skript von Pfitzmann beantwortet werden.

Das SMGW muss mindestens diese Anwendungsfälle unterstützen. D.h es können Anwendungsfälle erweitert werden.

-Was bei missbrauch, falscher Verbrauchsübermittlung oder Boykottierung des Netzes, sodass ein Falscher Zustand vermittelt wird?

-Grundzustand: Es ist davon auszugehen, dass es bereits mehrere Smart Meter Gateways gibt, die in einem bestehenden Grid operieren.

/// todo

anmeldung beim stromprovider --> der ordnet das smgw einer geographischen region zu und wählt ein geeigntes dc-netz aus.
registrierung:
austritt:
normale operation:
ausfall bei einem teilnehmer: temporäres entfernen von teilnehmer
was passiert, wenn alle eine lokale summe senden, aber der globale wert falsch ist.

gibt es einen algo um zwei graphen(schlüsselgraphen) miteinander zu vereinen?

differenzielle privacy

durchschnitt vom gesamtverbrauch vergleichen mit durchschnitt vom einem maximalen verbrauch zu dem zeitpunkt von einem nutzer und wie sehr dieser gesehen werden kann.


Also mittels eines sicheren kanals, der durch den Diffie-Hellman schlüsselaustausch erzeugt wurde, können die Seeds für einen PRNG kommuniziert werden.
-Was passiert wenn ein Teilnehmer entfernt wird? Dann wird eine definierte Nachrichten an den Stromprovider gesendet. Damit teilt das SMGW dem Stromprovider mit, dass es aus dem DC-Netz austreten wird. Dann bereitet der Stromprovider einen Tunnel vor, mit dem es dem austretenden DC-Client möglich ist eine Benachrichtigungsnachricht an seine "Nachbarn"(vom Schlüsselgraphen) zu senden. Mit dieser Benachrichtigung werden den Nachbarn signalisiert, dass sie ihre PRNG konfigurationen wegwerfen und diese nicht weiter in der Berechnung der lokalen Summe (in der nächsten generation) verwendet werden. Damit es nicht zu einer Störung der Synchronisation im DC-Netz kommt(was dazu führt, dass keine sinnvolle globale Summe errechnet werden kann), müssen die "Nachbarn" eine Bestätigung(das die Nachricht verstanden wurde und alle Seeds weggeworfen wurden) an den Stromprovider senden.
Schlüsselgraphen:
Es kann dazu kommen, dass beim Austritt eines Clients der DC-Schlüsselgraph in zwei Teile zerbricht. Das Problem hierbei ist, dass weder die SMGW Clients noch der Stromanbieter wissen, ob sich der Schlüsselgraph zerteilt. Sollte dies der Fall sein, so senden zwei voneinander getrennte DC-Netze auf die gleiche DC-Netz ID. Der Stromprovider könnte zwar trotzdem eine sinnvolle globale Summe bilden(weil quasi zwei globale Summen aufaddiert werden), aber man könnte schnell den überblick aus den daraus resultierenden Schlüsselgraphen verlieren. Eine mögliche Fehlererkennung bei Problemen könnte gar unmöglich werden.
Um zu überprüfen, ob der Schlüsselgraph noch funktionsfähig ist (also nicht zerbrochen) werden folgende Maßnahmen getroffen:
--> Der Stromanbieter broadcasted an alle Teilnehmer im DC-Netz eine verifizierungsnachricht(eine größere Zahl). Jeder Client, der die Verifizierungsnachricht erhalten hat, bildet die lokale Summe von der Nachricht und sendet diese an den Stromprovider zurück. Der Stromprovider bildet aus allen lokalen Summen die globale Summe und überprüft, ob das Ergebnis korrekt ist, indem alle ursprünglichen Verifizierungsnachrichten aufaddiert werden und mit der globalen Summe übereinstimmt. Ist das Ergebnis korrekt, dann ist der Schlüsselgraph nicht zerbrochen und das DC-Netz ist funktionsfähig.
Ist das Ergebnis nicht korrekt so ist der Schlüsselgraph zerteilt. In diesem Fall informiert der Stromanbieter alle Clients, dass die Verifizierung fehlgeschlagen ist. Damit es wieder einen einheitlichen Schlüsselgraph gibt, melden sich alle ehemaligen Nachbarn (des ausgetretenen Clients) beim Stromanbieter. Dann erstellt der Stromanbieter wieder einen Tunnel (so wie beim Eintreten) und stellt eine kommunikationsmöglichkeit für die ehemaligen Nachbarn her. Diese tauschen nun Seeds miteinander aus um PRNG konfigurieren zu können(also wie beim Eintritt in das DC-Netz). Durch diese Maßnahme ist es garantiert, dass es wieder einen einheitlichen Schlüsselgraph gibt und dem Stromanbieter ist es wieder möglich eine sinnvolle globale Summe zu bilden.
Mit diesem Verfahren ist es sogar möglich, dass der Stromanbieter keine Kenntnisse über den Schlüsselgraphen haben muss! (obwohl er den Schlüsselgraphen speichern könnte)
 

